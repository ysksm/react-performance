# データセンター監視システム ドキュメント

## 概要

このドキュメントは、React パフォーマンス最適化を実現するデータセンター監視システムの設計と実装について説明します。

## システム特徴

✅ **ドメイン駆動設計（DDD）**: ビジネスロジックの中心化と技術的関心事の分離
✅ **レイヤードアーキテクチャ**: 明確な責務分離による保守性向上
✅ **React パフォーマンス最適化**: React.memo とカスタム比較関数による効率的な再描画
✅ **リアルタイム更新**: 1秒間隔でのポーリングによるライブデータ表示
✅ **型安全性**: TypeScript と値オブジェクトによる堅牢な型システム
✅ **依存性注入**: テスタビリティと拡張性を確保する設計

## アーキテクチャ階層

```
┌─────────────────────────────────────┐
│         Presentation Layer          │  React Components, Hooks
├─────────────────────────────────────┤
│         Application Layer           │  Use Cases, Business Logic
├─────────────────────────────────────┤
│           Domain Layer              │  Entities, Value Objects, Business Rules
├─────────────────────────────────────┤
│        Infrastructure Layer         │  HTTP Clients, Data Mapping, DI
└─────────────────────────────────────┘
```

## ドキュメント構成

### 📋 [architecture.md](./architecture.md)
**システム全体のアーキテクチャ設計**
- コンポーネント依存関係図
- データフローシーケンス図
- ドメイン層クラス図
- DDD とレイヤードアーキテクチャの実装方針

### 🎯 [component-specifications.md](./component-specifications.md)
**React コンポーネントの詳細仕様**
- 各コンポーネントの責務と実装
- React パフォーマンス最適化戦略
- 状態管理パターン
- エラーハンドリング方針

### 🏗️ [ddd-implementation-guide.md](./ddd-implementation-guide.md)
**ドメイン駆動設計の実装ガイド**
- エンティティと値オブジェクトの実装パターン
- リポジトリパターンの実装
- ユースケースの設計方針
- 依存性注入の実装

## システム構成図

### 階層データ構造
```
DataCenter (データセンター)
├── Rack (ラック)
    ├── Server (サーバー)
        ├── Container (コンテナ)
```

### ビューモード遷移
```
Overview → Racks → Servers → Containers
   ↑         ↑        ↑         ↑
   └─────────┴────────┴─────────┘
     Navigation Breadcrumb
```

## 主要技術スタック

### フロントエンド
- **React 18**: UI フレームワーク
- **TypeScript**: 型安全性とコード品質
- **CSS Modules**: スタイリング
- **React.memo**: パフォーマンス最適化

### バックエンド
- **Node.js + Express**: API サーバー
- **TypeScript**: サーバーサイド型安全性
- **RESTful API**: データ取得・操作

### アーキテクチャパターン
- **Domain-Driven Design (DDD)**: ビジネスロジック中心の設計
- **Layered Architecture**: 責務分離によるモジュール化
- **Dependency Injection**: テスタビリティと拡張性
- **Repository Pattern**: データアクセス抽象化

## 主要機能

### 🖥️ リアルタイム監視
- CPU、メモリ、ディスク、ネットワーク使用率
- サーバー温度監視
- 接続状態管理 (online/offline/reconnecting)

### ⚡ サーバー操作
- サーバー起動・停止・再起動
- 確認ダイアログによる安全な操作
- 操作結果の通知表示

### 📦 コンテナ管理
- コンテナ起動・停止・一時停止・削除
- 新規コンテナ作成
- リアルタイムステータス監視

### 🧭 階層ナビゲーション
- データセンター → ラック → サーバー → コンテナ
- パンくずナビゲーション
- 任意の階層へのジャンプ

## パフォーマンス最適化

### React.memo 戦略
```typescript
// 構造的プロパティのみを比較
const areEqual = (prev, next) => {
  return prev.id === next.id &&
         prev.name === next.name &&
         prev.items.length === next.items.length;
  // 動的な数値（CPU、メモリ等）は比較しない
}
```

### メモ化の原則
1. **構造比較**: ID、名前等の不変プロパティ
2. **配列長チェック**: 要素数の変化検知
3. **動的値除外**: CPU、メモリ等の変動値は無視
4. **関数参照比較**: コールバック関数の等価性

## 開発・実行方法

### 前提条件
- Node.js 18+
- npm or yarn

### セットアップ
```bash
# 依存関係インストール
npm install

# API サーバー起動
cd api-server && npm run dev

# フロントエンド起動
npm run dev
```

### アクセス URL
- **フロントエンド**: http://localhost:5173
- **API サーバー**: http://localhost:3001
- **API ドキュメント**: http://localhost:3001/health

## 監視対象メトリクス

### サーバーメトリクス
- **CPU 使用率**: 0-100%（リアルタイム変動）
- **メモリ使用率**: 0-100%（リアルタイム変動）
- **ディスク使用率**: 0-100%（比較的安定）
- **ネットワーク使用率**: 0-100%（リアルタイム変動）
- **温度**: 30-80°C（リアルタイム変動）

### ステータス管理
- **サーバー**: running | stopped | warning | error | maintenance
- **コンテナ**: running | stopped | paused | error
- **接続状態**: online | offline | reconnecting

## エラーハンドリング

### 多層防御
1. **API 層**: HTTP エラーキャッチ
2. **Repository 層**: ドメイン例外変換
3. **UseCase 層**: ビジネスルール検証
4. **Presentation 層**: ユーザーフレンドリー表示

### 通知システム
- **Toast 通知**: 操作結果の表示
- **確認ダイアログ**: 危険操作の確認
- **接続インジケーター**: リアルタイム接続状態

## テスト戦略

### 単体テスト
- ドメインエンティティのビジネスルール
- 値オブジェクトの検証ロジック
- ユースケースの処理フロー

### 統合テスト
- コンポーネント間の連携
- API との通信
- データフローの検証

### E2E テスト
- ユーザーシナリオ実行
- リアルタイム更新確認
- エラーシナリオ検証

## 今後の拡張可能性

### 機能拡張
- **アラート機能**: 閾値監視と通知
- **ダッシュボード**: グラフィカルなメトリクス表示
- **ユーザー管理**: 認証・認可機能
- **ログ管理**: 操作履歴とシステムログ

### 技術的改善
- **WebSocket**: よりリアルタイムな更新
- **キャッシュ戦略**: パフォーマンス向上
- **マイクロサービス**: API の分散化
- **コンテナ化**: Docker による環境統一

## 貢献ガイドライン

### コード品質
1. **型安全性**: TypeScript の厳密な型チェック
2. **テストカバレッジ**: 80% 以上の維持
3. **ESLint/Prettier**: コードスタイルの統一
4. **コミット規約**: Conventional Commits の採用

### アーキテクチャ原則
1. **単一責任原則**: 各コンポーネント・クラスは単一の責務
2. **依存性逆転**: 抽象に依存し、具象に依存しない
3. **オープン・クローズド原則**: 拡張に開放、修正に閉鎖
4. **インターフェース分離**: 小さく特化したインターフェース

## ライセンス

MIT License

## 連絡先

プロジェクトに関するご質問は、Issues または Pull Request でお寄せください。

---

**このドキュメントは、システムの理解と開発効率向上を目的として作成されました。
継続的な改善により、常に最新の状態を保つよう努めています。**